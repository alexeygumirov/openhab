// import org.openhab.core.library.types.DecimalType

var int lowBatteryThreshold = 10

rule "Battery Monitor"
when Time cron "0 0 18 * * ?"
// when Time cron "0 0/5 * * * ?"
then
    if (! gBattery.allMembers.filter([state < lowBatteryThreshold]).empty) {
        
	val report = gBattery.allMembers.sortBy[state].map[label + ": " + state.format("%d%%")].join("\n")

	// original code === val report = gBattery.allMembers.filter([state instanceof DecimalType]).sortBy([state]).map[name + ": " + state.format("%d%%")].join("\n")
	
	// val report = gBattery.allMembers.filter([state < lowBatteryThreshold]).sortBy([state]).map[name + ": " + state.format("%d%%")].join("\n")        

        sendTelegram("BOT_NAME", "Низкий уровень заряда батарей:\n\n" + report + "\n")
    }
end
